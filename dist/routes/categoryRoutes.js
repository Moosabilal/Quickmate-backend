import { Router } from "express";
import { authenticateToken, authorizeRoles } from "../middleware/authMiddleware";
import upload from "../utils/multer";
import TYPES from "../di/type";
import { container } from "../di/container";
const router = Router();
const categoryController = container.get(TYPES.CategoryController);
const isAdmin = [authenticateToken, authorizeRoles(["Admin"])];
const isAdminOrUserOrProvider = [authenticateToken, authorizeRoles(["Admin", "Customer", "ServiceProvider"])];
router.get("/", categoryController.getAllCategories);
router.post("/", isAdmin, upload.single("categoryIcon"), categoryController.createCategory);
router.get("/commission-summary", isAdmin, categoryController.getCommissionSummary);
router.get("/top-level", categoryController.getTopLevelCategories);
router.get("/popular-services", categoryController.getPopularServices);
router.get("/trending-services", categoryController.getTrendingServices);
router.get("/edit/:id", isAdminOrUserOrProvider, categoryController.getCategoryForEdit);
router.get("/getAllSubCategories", categoryController.getSubCategories);
router.get("/:id/related", categoryController.getRelatedCategories);
router.put("/:id", isAdmin, upload.single("categoryIcon"), categoryController.updateCategory);
router.get("/:id", categoryController.getCategoryById);
export default router;
